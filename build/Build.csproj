<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Library</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <Nullable>disable</Nullable>
	<NoWarn>CS0649;CS0169;MSB3277</NoWarn>
    <AssemblyName>RcaPlugin</AssemblyName>
    <RootNamespace>RcaPlugin</RootNamespace>
    <EnableDefaultItems>false</EnableDefaultItems>
    <PlatformTarget>x64</PlatformTarget>
    <RevitVersion>2026</RevitVersion>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="..\src\**\*.cs" />
  </ItemGroup>

  <!-- WPF XAML and resources from src -->
  <ItemGroup>
    <Page Include="..\src\Views\**\*.xaml">
      <Link>Views\%(RecursiveDir)%(Filename)%(Extension)</Link>
    </Page>
  </ItemGroup>

  <ItemGroup>
    <Reference Include="RevitAPI">
      <HintPath>$(ProgramFiles)\Autodesk\Revit $(RevitVersion)\RevitAPI.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>$(ProgramFiles)\Autodesk\Revit $(RevitVersion)\RevitAPIUI.dll</HintPath>
      <Private>False</Private>
    </Reference>
  </ItemGroup>

  <!-- Deploy .addin file and built DLL after build -->
  <Target Name="DeployRevitAddin" AfterTargets="Build">
    <PropertyGroup>
      <RevitAddinsDir>$(APPDATA)\Autodesk\Revit\Addins\$(RevitVersion)</RevitAddinsDir>
      <AddinPluginDir>$(RevitAddinsDir)\RcaPlugin</AddinPluginDir>
    </PropertyGroup>

    <MakeDir Directories="$(AddinPluginDir)" />

    <!-- Copy the .addin manifest file -->
    <Copy SourceFiles="$(MSBuildProjectDirectory)\..\src\RcaPlugin.addin"
          DestinationFiles="$(RevitAddinsDir)\RcaPlugin.addin"
          SkipUnchangedFiles="true"
          ContinueOnError="WarnAndContinue" />

    <!-- Copy only necessary files for Revit plugin -->
    <ItemGroup>
      <DeployFiles Include="$(TargetDir)**\*.dll" />
      <!-- Explicitly exclude debugging and dependency files -->
      <DeployFiles Remove="$(TargetDir)**\*.pdb" />
      <DeployFiles Remove="$(TargetDir)**\*.deps.json" />
    </ItemGroup>
    <Copy SourceFiles="@(DeployFiles)"
          DestinationFolder="$(AddinPluginDir)"
          SkipUnchangedFiles="true"
          ContinueOnError="WarnAndContinue" />
  </Target>

</Project>